<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AMD Promise Tests</title>
</head>

<body>
    <script src="jquery.js"></script>
    <script src="promise.js"></script>
    <script>
        function timeout(ms) {
            return new Promise((resolve, reject) => {
                setTimeout(resolve, ms, 'done');
            });
        }

        var $parent = $("body"); // 获取<ul>节点。<li>的父节点
        timeout(1000).then((value) => {
            $parent.append($("<div>" + value + "</div>"));
            $parent.append($("<br/>"));
            $parent.append($("<br/>"));
        });

        console.log(PromisePolyfill.prototype.constructor);

        var p1 = new PromisePolyfill(function (resolve, reject) {
            throw new Error('fail');
        })

        var p2 = new PromisePolyfill(function (resolve, reject) {
            resolve(p1);
        })

        p2.then(result => {
                $parent.append($("<div>" + result + "</div>"));
                $parent.append($("<br/>"))
            })
            .catch(error => {
                $parent.append($("<div>" + error + "</div>"));
                $parent.append($("<br/>"))
            });


        console.log('p2.then');

        console.log(typeof global);


        // var promise1 = new MyPromisePolyfill(function (resolve) {
        //     resolve('hello world');
        // });
        // var promise2 = new MyPromisePolyfill(function (resolve) {
        //     resolve(promise1);
        // });
        // promise2.then(function (value) {
        //     assert(value === 'hello world'); // true
        // });
    </script>
</body>

</html>